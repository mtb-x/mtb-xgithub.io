<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Playing Card Generator</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #2c3e50;
    color: #ecf0f1;
    padding: 20px;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    margin: 0;
}
/* The main content grows to fill space */
.content {
    flex: 1;
}

/* Footer styling */
.footer {
    /* background: #1abc9c; */
    color: rgb(154, 154, 154);
    text-align: center;
    padding: 12px;
    font-size: 12px;
    /* font-weight: bold; */
}

.footer a {
    text-decoration: none;
    color: rgb(90, 106, 221);
}

h1 { text-align: center; }

.controls {
    max-width: 1200px; margin: 0 auto 20px; display: flex; gap: 12px; align-items: flex-end;
}

.controls input[type="number"], .controls button {
    padding: 6px; border-radius: 4px; border: none;
}

.controls button { background: #1abc9c; font-weight: bold; cursor: pointer; }
.controls button:hover { background: #16a085; }

/* Generic button styling */

button {
    background: #1abc9c; 
    font-weight: bold; 
    cursor: pointer; 
    padding: 6px; border-radius: 4px; border: none;
}
button:hover { background: #16a085; }

.cards { display: flex; flex-wrap: wrap; gap: 16px; justify-content: center; margin-bottom: 30px; }

.card {
    width: 110px; height: 160px; background: #ecf0f1; border-radius: 10px; padding: 8px; margin-top:5px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.4); animation: deal 0.4s ease-out forwards; opacity:0; position: relative;
}

@keyframes deal { to { opacity:1; transform: translateY(0); } }

.card.red { color: #c0392b; }
.card.black { color: #2c3e50; }

.rank { font-weight: bold; }
.rank.bottom { position: absolute; bottom: 8px; right: 8px; transform: rotate(180deg); }

.pips { display: grid; grid-template-columns: repeat(3,1fr); grid-template-rows: repeat(5,1fr); height:100%; align-items:center; justify-items:center; }
.face { font-size:3em; text-align:center; line-height:120px; }
.joker { font-size:1.8em; text-align:center; line-height:140px; }

.stack-label {
    display:block;
    margin-bottom: 3px;
    font-size: 10px;
    text-align: center;
}

.panels {
    display: flex;
    gap: 20px;
    max-width: 1200px;
    margin: 0 auto;
    align-items: flex-start; /* ðŸ‘ˆ key line */
}
.panel {background:#34495e; padding:15px; border-radius:8px;}
/* .history { max-width: 1200px;} */
.history {
    flex: 1;
    height: 400px;
    overflow-y: auto;
    width:20px;
}

.stack-panel {
    flex: 1; /* smaller panel */
}
.history .hist-log-stack-txt {
    display: none; /* by default, have these hidden */
    color: #787878;
}

.flex-col {
    display: flex;
    flex-direction: column;
    gap: 10px; /* space between select and button */
}

.flex-col select,
.flex-col button {
    width: 100%; /* optional, looks nicer */
}

.flex-row {
    display: flex;
    align-items: center;
    gap: 10px;
}

.right-panes{
    flex:0.5;
}

.panel-titles{
    font-size:20px;
    font-weight: bold;
}

.flex-row label {
    white-space: nowrap; /* prevents label wrapping */
}


/* .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
.modal-content { background:#34495e; padding:20px; border-radius:8px; max-width:700px; width:90%; max-height:90%; overflow:auto; }
.modal-content h2 { margin-top:0; } */
.modal {
  display: flex;
  justify-content: center;
  align-items: center;
  position: fixed;
  top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.7);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.modal.show {
  opacity: 1;
  pointer-events: auto;
}

.modal-content {
  background:#34495e;
  padding:20px;
  border-radius:8px;
  max-width:700px;
  width:90%;
}
.close-btn { float:right; background:#c0392b; border:none; color:white; padding:4px 10px; font-weight:bold; cursor:pointer; }
.close-btn:hover { background:#e74c3c; }

.group { margin-bottom:12px; font-size:0.85em; }
.group label { display:block; margin-left:12px; }
.group strong{ 
    display: block;       /* ensure it's on its own line */
    margin-bottom: 4px;   /* increase this value for more space */
}
.select-buttons { margin-bottom:6px; }
.select-buttons button { margin-right:6px; padding:4px 8px; font-size:0.8em; border:none; border-radius:4px; cursor:pointer; }
.select-buttons button:hover { background:#16a085; }
.card-count { font-size:0.9em; margin-top:8px; color:#ecf0f1; }

/* Show rank checkboxes in grid layout */
.grid-modal-check-boxes {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* two columns */
    gap: 4px 6px; /* vertical and horizontal gap */
}

</style>
<!-- Favicon -->
<link rel="icon" type="image/png" href="images/favicon.png"/>
<!--  -->
</head>
<body>
<div class="content">
    
<h1>Playing Card Generator</h1>

<!-- <div class="controls"> -->
    <!-- <div>
        <label>Number of cards</label>
        <input type="number" id="count" min="1" max="54" value="1">
    </div> -->
    <!-- <button id="settingsBtn">Settings</button> -->
    <!-- <button id="generateBtn">Generate</button> -->
<!-- </div> -->

<div class="cards" id="cards"></div>

<div class="panels">
    <div class="panel history">
        <p><span class="panel-titles">History</span> <button style="margin-left: 15px;"id="clearhist">Clear</button></p>
        <ul id="history"></ul>
    </div>

    <div class="right-panes flex-col">
    <div class="panel">
        <p class="panel-titles">Generate cards</p>
        <div class="flex-col">
        <div class="flex-row">
        <div>
            <label>Number of cards</label>
            <input type="number" id="count" min="1" max="54" value="1">
        </div>
        <button id="settingsBtn" style="width: 45%;">Settings</button>
        </div>
        <button id="generateBtn">Generate</button>
        </div>
    </div>

    <div class="panel stack-panel">
        <p><span class="panel-titles">Stack Settings</span></p>
        <div class="flex-col">
        <div class="flex-row">
        <label for="stack-opt">Stack:</label>
        <select name="stack-opt" id="stack-lst">
            <option value="newdeck">New deck order</option>
            <option value="ps">Particle Stack</option>
        </select></div>
        <label><input type="checkbox" class="" value="stck-clk2revl-enabled" unchecked>Click to reveal</label>
        <button id="stackToggleBtn">Show stack info</button>
        </div>
    </div>
    </div>
</div>

<!-- Modal -->
<div class="modal" id="modal">
    <div class="modal-content">
        <button class="close-btn" id="closeModal">X</button>
        <h2>Customise generation settings</h2>

        <div class="group">
            <strong>Suit</strong>
            <div class="select-buttons">
                <button type="button" id="selectAllSuits">Select All</button>
                <button type="button" id="deselectAllSuits">Deselect All</button>
                <button type="button" id="selectReds">Select Reds</button>
                <button type="button" id="selectBlacks">Select Blacks</button>
            </div>
            <div class="grid-modal-check-boxes">
                <label><input type="checkbox" class="suit" value="hearts" checked> Hearts</label>
                <label><input type="checkbox" class="suit" value="diamonds" checked> Diamonds</label>
                <label><input type="checkbox" class="suit" value="clubs" checked> Clubs</label>
                <label><input type="checkbox" class="suit" value="spades" checked> Spades</label>
            </div>
        </div>

        <div class="group">
            <strong>Ranks</strong>
            <div class="select-buttons">
                <button type="button" id="selectAllRanks">Select All</button>
                <button type="button" id="deselectAllRanks">Deselect All</button>
                <button type="button" id="selectAllCourtsRanks">Select Courts</button>
                <button type="button" id="selectAllNumsRanks">Select Numbers</button>
            </div>
            <div class="grid-modal-check-boxes" id="rankCheckboxes"></div>
        </div>

        <div class="group">
            <strong>Additional settings</strong>
            <div class="grid-modal-check-boxes">
                <label><input type="checkbox" id="noDupes" checked> Prevent duplicates</label>
                <label><input type="checkbox" id="jokers"> Include jokers</label>
            </div>
        </div>

        <div class="card-count" id="cardCountDisplay">Possible cards: 0</div>
    </div>
</div>
</div>
  <footer class="footer">
    Developed in 2025. Playing cards images from <a target="_blank" rel="noopener noreferrer" href="https://code.google.com/archive/p/vector-playing-cards/">Google code archive: vector-playing-cards</a>. Favicon: <a target="_blank" rel="noopener noreferrer" href="https://www.flaticon.com/free-icons/playing-cards" title="playing cards icons">Playing cards icons created by riajulislam - Flaticon</a>
  </footer>
<!-- Include stacks BEFORE main JS <script> -->
<script src="stacks/new-deck-stack.js"></script><!-- const new_deck_stack-->
<script>
/* ---------- DATA ---------- */
const suits = [
    { name:"hearts", label:"Hearts", symbol:"â™¥", color:"red" },
    { name:"diamonds", label:"Diamonds", symbol:"â™¦", color:"red" },
    { name:"clubs", label:"Clubs", symbol:"â™£", color:"black" },
    { name:"spades", label:"Spades", symbol:"â™ ", color:"black" }
];
const ranks = [
    { v:2,l:"2" },{ v:3,l:"3" },{ v:4,l:"4" },{ v:5,l:"5" },
    { v:6,l:"6" },{ v:7,l:"7" },{ v:8,l:"8" },{ v:9,l:"9" },
    { v:10,l:"10" },{ v:11,l:"J" },{ v:12,l:"Q" },
    { v:13,l:"K" },{ v:14,l:"A" }
];


/* ---------- DOM ---------- */
const rankBox = document.getElementById("rankCheckboxes");
const cardsDiv = document.getElementById("cards");
const historyList = document.getElementById("history");
const settingsBtn = document.getElementById("settingsBtn");
const modal = document.getElementById("modal");
const closeModal = document.getElementById("closeModal");
const generateBtn = document.getElementById("generateBtn");
const cardCountDisplay = document.getElementById("cardCountDisplay");
const clearHistBtn = document.getElementById("clearhist");
const toggleStackBtn = document.getElementById("stackToggleBtn");

/* ---------- INIT ---------- */
ranks.forEach(r=>{
    const lbl = document.createElement("label");
    lbl.innerHTML = `<input type="checkbox" class="rank" value="${r.v}" checked> ${r.l}`;
    rankBox.appendChild(lbl);
});

/* ---------- SELECT ALL / NONE ---------- */
document.getElementById("selectAllSuits").addEventListener("click",()=>document.querySelectorAll(".suit").forEach(c=>{c.checked=true;updateCardCount();}));
document.getElementById("deselectAllSuits").addEventListener("click",()=>document.querySelectorAll(".suit").forEach(c=>{c.checked=false;updateCardCount();}));
document.getElementById("selectReds").addEventListener("click",()=>document.querySelectorAll(".suit").forEach(c=>{
    if (c.value === "hearts" || c.value === "diamonds") {
        c.checked=true;
    } else {
        c.checked=false;
    }
    updateCardCount();
}));
document.getElementById("selectBlacks").addEventListener("click",()=>document.querySelectorAll(".suit").forEach(c=>{
    if (c.value === "hearts" || c.value === "diamonds") {
        c.checked=false;
    } else {
        c.checked=true;
    }
    updateCardCount();
}));

document.getElementById("selectAllRanks").addEventListener("click",()=>document.querySelectorAll(".rank").forEach(c=>{c.checked=true;updateCardCount();}));
document.getElementById("deselectAllRanks").addEventListener("click",()=>document.querySelectorAll(".rank").forEach(c=>{c.checked=false;updateCardCount();}));
document.getElementById("selectAllCourtsRanks").addEventListener("click",()=>document.querySelectorAll(".rank").forEach(c=>{
    if (c.value > 10) {
        c.checked=true;
    } else {
        c.checked=false;
    }
    // Special case for Ace
    if (c.value == 14){
        c.checked=false;
    }
    updateCardCount();
}));
document.getElementById("selectAllNumsRanks").addEventListener("click",()=>document.querySelectorAll(".rank").forEach(c=>{
    if (c.value <= 10) {
        c.checked=true;
    } else {
        c.checked=false;
    }
    // Special case for Ace
    if (c.value == 14){
        c.checked=true;
    }
    updateCardCount();
}));
/* ---------- MODAL ---------- */
//settingsBtn.addEventListener("click", ()=> { modal.style.display="flex"; updateCardCount(); });

// Open modal with fade-in
settingsBtn.addEventListener("click", () => {
  modal.classList.add("show");
  document.body.style.overflow = "hidden"; // Prevent background scroll
});

// closeModal.addEventListener("click", ()=> modal.style.display="none");
// Close modal with fade-out
closeModal.addEventListener("click", () => {
  modal.classList.remove("show");
  document.body.style.overflow = ""; // Restore scrolling
});

// Optional: click outside to close
window.addEventListener("click", e => {
  if (e.target === modal) modal.classList.remove("show");
  document.body.style.overflow = ""; // Restore scrolling
});

// window.addEventListener("click", e=> { if(e.target===modal) modal.style.display="none"; });


/* ---------- INIT STACK ---------- */
let showStack = false;
const current_stack = new_deck_stack //TODO: Change default 

/* ---------- CARD COUNT UPDATE ---------- */
function updateCardCount(){
    const suitsSelected = [...document.querySelectorAll(".suit:checked")].map(s=>s.value);
    const ranksSelected = [...document.querySelectorAll(".rank:checked")].map(r=>+r.value);
    const jokers = document.getElementById("jokers").checked;

    let deckCount = 0;
    suits.forEach(s=>{
        if(suitsSelected.length && !suitsSelected.includes(s.name)) return;
        ranks.forEach(r=>{
            if(!ranksSelected.includes(r.v)) return;
            deckCount++;
        });
    });
    if(jokers){
        deckCount++;
        deckCount++;
    }
    cardCountDisplay.textContent = `Possible cards: ${deckCount}`;
}
document.querySelectorAll(".color, .suit, .rank, #jokers").forEach(el=>el.addEventListener("change", updateCardCount));
updateCardCount() // Invoke first time

/* ---------- LOGIC ---------- */
generateBtn.addEventListener("click", generateCards);

function generateCards(){
    cardsDiv.innerHTML = "";

    const count = +document.getElementById("count").value;
    const suitNames = [...document.querySelectorAll(".suit:checked")].map(s=>s.value);
    const rankVals = [...document.querySelectorAll(".rank:checked")].map(r=>+r.value);
    const noDupes = document.getElementById("noDupes").checked;
    const jokers = document.getElementById("jokers").checked;

    let deck = [];
    suits.forEach(s=>{
        if(suitNames.length && !suitNames.includes(s.name)) return;
        ranks.forEach(r=>{
            if(!rankVals.includes(r.v)) return;
            deck.push({s,r});
        });
    });

    if(jokers){
        deck.push({joker:true,color:"red"});
        deck.push({joker:true,color:"black"});
    }

    if(noDupes && count > deck.length){
        alert("Not enough cards matching constraints.");
        return;
    }

    for(let i=0;i<count;i++){
        const idx = Math.floor(Math.random()*deck.length);
        const card = deck[idx];
        if(noDupes) deck.splice(idx,1);
        renderCard(card);
        log(card);
        // get_stack_number_for_card(card)
    }
}

function renderCard(c){
    const d = document.createElement("div");
    d.className = "card"; // keep the card styling for size/shadow

    let imgSrc = "";

    if(c.joker){
        // If you also have Joker images, you could do something like:
        imgSrc = `${c.color}_joker.png`; // adjust filename if needed
    } else {
        let rankName = "";
        // Map numeric values to filenames
        if(c.r.v >= 2 && c.r.v <= 10){
            rankName = c.r.l; // 2-10
        } else if(c.r.v === 11){
            rankName = "jack";
        } else if(c.r.v === 12){
            rankName = "queen";
        } else if(c.r.v === 13){
            rankName = "king";
        } else if(c.r.v === 14){
            rankName = "ace";
        }

        // Check if it's a face card that uses the "2" suffix
        const faceCard = ["jack","queen","king"];
        if(faceCard.includes(rankName)){
            imgSrc = `${rankName}_of_${c.s.name}2.png`;
        } else {
            imgSrc = `${rankName}_of_${c.s.name}.png`;
        }
    }

    // Create the image element
    const img = document.createElement("img");
    img.src = `images/${imgSrc}`; // assuming all images are in ./images/ folder
    img.alt = c.joker ? `${c.color} Joker` : `${c.r.l} of ${c.s.label}`;
    img.style.width = "100%";
    img.style.height = "100%";
    img.style.objectFit = "contain";

    // Create stack label for card
    const stack_label = document.createElement("p");
    stack_label.className = "stack-label";
    stack_label.textContent = "stack position: " + get_stack_number_for_card(c)
    stack_label.style.display = showStack ? "block" : "none";

    d.appendChild(img);
    d.appendChild(stack_label);
    cardsDiv.appendChild(d);
}

/* ---------- HISTORY LIST ---------- */

function log(c){
    const li = document.createElement("li");
    const cardName = c.joker 
        ? `${c.color} Joker` 
        : capitalizeFirstLetter(get_rank_name(c)) + ` of ${c.s.label}`;
    const stackNumber = get_stack_number_for_card(c);
    let show_stack_style = showStack ? "inline" : "none";
    li.innerHTML = `${cardName} <span class="hist-log-stack-txt" style="display:${show_stack_style}">(Stack: ${stackNumber})</span>`;
    historyList.appendChild(li);
}

clearHistBtn.addEventListener("click", () => {
  console.log("Clearing history")
  // remove everything from list
  historyList.innerHTML = '';
});

/* ---------- STACK NUMBERS ---------- */

function get_stack_number_for_card(c){
    let card = c.joker ? `${c.color}_joker` : get_rank_name(c) + `_of_${c.s.label}`.toLowerCase();
    console.log("getting stack number for card " + card) // TODO: Remove
    console.log(current_stack[card])
    return current_stack[card]
}

// toggle showing stack info
toggleStackBtn.addEventListener("click", () => {
  showStack = !showStack // flip showStack bool
  toggleStackBtn.textContent = showStack ? "Hide stack info" : "Show stack info"
  const sls = document.querySelectorAll("p.stack-label");
    sls.forEach(p => {
        p.style.display = showStack ? "block" : "none";
    });
  const spans = document.querySelectorAll(".hist-log-stack-txt");
    spans.forEach(p => {
        p.style.display = showStack ? "inline" : "none";
    });
});

/* ---------- CARD UTILS ---------- */

function get_rank_name(c){
    let rankName = "";
    // Map numeric values to filenames
    if(c.r.v >= 2 && c.r.v <= 10){
        rankName = c.r.l; // 2-10
    } else if(c.r.v === 11){
        rankName = "jack";
    } else if(c.r.v === 12){
        rankName = "queen";
    } else if(c.r.v === 13){
        rankName = "king";
    } else if(c.r.v === 14){
        rankName = "ace";
    }
    return rankName;
}

function capitalizeFirstLetter(val) {
    return String(val).charAt(0).toUpperCase() + String(val).slice(1);
}



</script>
</body>
</html>
